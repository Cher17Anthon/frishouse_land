!function(e,r,a,t){var s=s||{};t.callbacksObjectTemplate=function(){return{before:[],response:{success:[],error:[]},ajax:{done:[],fail:[],always:[]}}},s.Callbacks=t.Callbacks={Cart:{add:t.callbacksObjectTemplate(),remove:t.callbacksObjectTemplate(),change:t.callbacksObjectTemplate(),clean:t.callbacksObjectTemplate()},Order:{add:t.callbacksObjectTemplate(),getcost:t.callbacksObjectTemplate(),clean:t.callbacksObjectTemplate(),submit:t.callbacksObjectTemplate(),getrequired:t.callbacksObjectTemplate()}},s.Callbacks.add=function(e,r,a){if("function"!=typeof a)return!1;e=e.split(".");for(var t=s.Callbacks,n=0;n<e.length;n++){if(null==t[e[n]])return!1;t=t[e[n]]}return"object"!=typeof t&&(t=[t]),null!=r?t[r]=a:t.push(a),!0},s.Callbacks.remove=function(e,r){e=e.split(".");for(var a=s.Callbacks,t=0;t<e.length;t++){if(null==a[e[t]])return!1;a=a[e[t]]}return null!=a[r]&&(delete a[r],!0)},s.ajaxProgress=!1,s.setup=function(){this.actionName="ms2_action",this.action=":submit[name="+this.actionName+"]",this.form=".ms2_form",this.$doc=a(r),this.sendData={$form:null,action:null,formData:null},this.timeout=300},s.initialize=function(){s.setup(),s.$doc.ajaxStart((function(){s.ajaxProgress=!0})).ajaxStop((function(){s.ajaxProgress=!1})).on("submit",s.form,(function(e){e.preventDefault();var r=a(this),t=r.find(s.action).val();if(t){var n=r.serializeArray();n.push({name:s.actionName,value:t}),s.sendData={$form:r,action:t,formData:n},s.controller()}})),s.Cart.initialize(),s.Message.initialize(),s.Order.initialize(),s.Gallery.initialize()},s.controller=function(){switch(this.sendData.action){case"cart/add":s.Cart.add();break;case"cart/remove":s.Cart.remove();break;case"cart/change":s.Cart.change();break;case"cart/clean":s.Cart.clean();break;case"order/submit":s.Order.submit();break;case"order/clean":s.Order.clean();break;default:return}},s.send=function(e,n,o){var c=function(e,r){if("function"==typeof e)return e.apply(r,Array.prototype.slice.call(arguments,2));if("object"==typeof e)for(var a in e)if(e.hasOwnProperty(a)){var t=e[a].apply(r,Array.prototype.slice.call(arguments,2));if(!1===t)return!1}return!0};a.isArray(e)?e.push({name:"ctx",value:t.ctx}):a.isPlainObject(e)?e.ctx=t.ctx:"string"==typeof e&&(e+="&ctx="+t.ctx);var i=!!s.sendData.$form&&s.sendData.$form.attr("action"),l=i||(t.actionUrl?t.actionUrl:r.location.href),d=!!s.sendData.$form&&s.sendData.$form.attr("method"),u=d||"post";if(!1!==c(n.before)&&!1!==c(o.before))var m=function(r,t){return a[u](l,e,(function(e){e.success?(e.message&&s.Message.success(e.message),c(r.response.success,s,e),c(t.response.success,s,e)):(s.Message.error(e.message),c(r.response.error,s,e),c(t.response.error,s,e))}),"json").done((function(){c(r.ajax.done,s,m),c(t.ajax.done,s,m)})).fail((function(){c(r.ajax.fail,s,m),c(t.ajax.fail,s,m)})).always((function(){c(r.ajax.always,s,m),c(t.ajax.always,s,m)}))}(n,o)},s.Cart={callbacks:{add:t.callbacksObjectTemplate(),remove:t.callbacksObjectTemplate(),change:t.callbacksObjectTemplate(),clean:t.callbacksObjectTemplate()},setup:function(){s.Cart.cart="#msCart",s.Cart.miniCart="#msMiniCart",s.Cart.miniCartClass=".msMiniCart",s.Cart.miniCartNotEmptyClass="full",s.Cart.countInput="input[name=count]",s.Cart.totalWeight=".ms2_total_weight",s.Cart.totalCount=".ms2_total_count",s.Cart.totalCost=".ms2_total_cost",s.Cart.totalDiscount=".ms2_total_discount",s.Cart.cost=".ms2_cost"},initialize:function(){s.Cart.setup(),a(s.Cart.cart).length&&s.$doc.on("change",s.Cart.cart+" "+s.Cart.countInput,(function(){a(this).val()&&a(this).closest(s.form).submit()}))},add:function(){s.Cart.callbacks.add.response.success=function(e){this.Cart.status(e.data)},s.send(s.sendData.formData,s.Cart.callbacks.add,s.Callbacks.Cart.add)},remove:function(){s.Cart.callbacks.remove.response.success=function(e){this.Cart.remove_position(s.Utils.getValueFromSerializedArray("key")),this.Cart.status(e.data)},s.send(s.sendData.formData,s.Cart.callbacks.remove,s.Callbacks.Cart.remove)},change:function(){s.Cart.callbacks.change.response.success=function(e){void 0===e.data.key?this.Cart.remove_position(s.Utils.getValueFromSerializedArray("key")):a("#"+s.Utils.getValueFromSerializedArray("key")).find(""),this.Cart.status(e.data)},s.send(s.sendData.formData,s.Cart.callbacks.change,s.Callbacks.Cart.change)},status:function(e){if(e.total_count<1)location.reload();else{var r=a(s.Cart.miniCart).add(s.Cart.miniCartClass);e.total_count>0&&r.length>0&&r.each((function(e,r){a(r).hasClass(s.Cart.miniCartNotEmptyClass)||a(r).addClass(s.Cart.miniCartNotEmptyClass)})),a(s.Cart.totalWeight).text(s.Utils.formatWeight(e.total_weight)),a(s.Cart.totalCount).text(e.total_count),a(s.Cart.totalCost).text(s.Utils.formatPrice(e.total_cost)),a(s.Cart.totalDiscount).text(s.Utils.formatPrice(e.total_discount)),"number"==typeof e.cost&&a(s.Cart.cost,"#"+e.key).text(s.Utils.formatPrice(e.cost)),a(s.Order.orderCost,s.Order.order).length&&s.Order.getcost()}},clean:function(){s.Cart.callbacks.clean.response.success=function(e){this.Cart.status(e.data)},s.send(s.sendData.formData,s.Cart.callbacks.clean,s.Callbacks.Cart.clean)},remove_position:function(e){a("#"+e).remove()}},s.Gallery={setup:function(){s.Gallery.gallery=a("#msGallery"),s.Gallery.files=s.Gallery.gallery.find(".fotorama")},initialize:function(){s.Gallery.setup(),s.Gallery.files.length&&(a("<link/>",{rel:"stylesheet",type:"text/css",href:t.cssUrl+"lib/fotorama.min.css"}).appendTo("head"),a("<script/>",{type:"text/javascript",src:t.jsUrl+"lib/fotorama.min.js"}).appendTo("head")),s.$doc.on("fotorama:ready",s.Gallery.files,(function(e,r,t){if((src=r.activeFrame.src)&&(measure=a.Fotorama.measures[src],void 0===measure)){for(i in a.Fotorama.measures){measure=a.Fotorama.measures[i];break}r.resize(measure)}}))}},s.Order={callbacks:{add:t.callbacksObjectTemplate(),getcost:t.callbacksObjectTemplate(),clean:t.callbacksObjectTemplate(),submit:t.callbacksObjectTemplate(),getrequired:t.callbacksObjectTemplate()},setup:function(){s.Order.order="#msOrder",s.Order.deliveries="#deliveries",s.Order.payments="#payments",s.Order.deliveryInput='input[name="delivery"]',s.Order.inputParent=".input-parent",s.Order.paymentInput='input[name="payment"]',s.Order.paymentInputUniquePrefix="input#payment_",s.Order.deliveryInputUniquePrefix="input#delivery_",s.Order.orderCost="#ms2_order_cost",s.Order.cartCost="#ms2_order_cart_cost",s.Order.deliveryCost="#ms2_order_delivery_cost"},initialize:function(){(s.Order.setup(),a(s.Order.order).length)&&(s.$doc.on("click",s.Order.order+' [name="'+s.actionName+'"][value="order/clean"]',(function(e){s.Order.clean(),e.preventDefault()})).on("change",s.Order.order+" input,"+s.Order.order+" textarea",(function(){var e=a(this),r=e.attr("name");if(r){var t=e.val();s.Order.add(r,t)}})),a(s.Order.deliveryInput+":checked",s.Order.order).trigger("change"))},updatePayments:function(e){var r=a(s.Order.paymentInput,s.Order.order);if(r.attr("disabled",!0).prop("disabled",!0).closest(s.Order.inputParent).hide(),e.length>0)for(var t in e)e.hasOwnProperty(t)&&r.filter(s.Order.paymentInputUniquePrefix+e[t]).attr("disabled",!1).prop("disabled",!1).closest(s.Order.inputParent).show();0==r.filter(":visible:checked").length&&r.filter(":visible:first").trigger("click")},add:function(e,r){var t=s.Order.callbacks,n=r;t.add.response.success=function(t){!function(e,r,n){var o=a('[name="'+e+'"]',s.Order.order);switch(e){case"delivery":o=a(s.Order.deliveryInputUniquePrefix+t.data[e]),t.data[e]!=n?o.trigger("click"):(s.Order.getrequired(r),s.Order.updatePayments(o.data("payments")),s.Order.getcost());break;case"payment":o=a(s.Order.paymentInputUniquePrefix+t.data[e]),t.data[e]!=n?o.trigger("click"):s.Order.getcost()}o.val(t.data[e]).removeClass("error").closest(s.Order.inputParent).removeClass("error")}(e,r,n)},t.add.response.error=function(){!function(e){var r=a('[name="'+e+'"]',s.Order.order);"checkbox"==r.attr("type")||"radio"==r.attr("type")?r.closest(s.Order.inputParent).addClass("error"):r.addClass("error")}(e)};var o={key:e,value:r};o[s.actionName]="order/add",s.send(o,s.Order.callbacks.add,s.Callbacks.Order.add)},getcost:function(){s.Order.callbacks.getcost.response.success=function(e){a(s.Order.orderCost,s.Order.order).text(s.Utils.formatPrice(e.data.cost)),a(s.Order.cartCost,s.Order.order).text(s.Utils.formatPrice(e.data.cart_cost)),a(s.Order.deliveryCost,s.Order.order).text(s.Utils.formatPrice(e.data.delivery_cost))};var e={};e[s.actionName]="order/getcost",s.send(e,s.Order.callbacks.getcost,s.Callbacks.Order.getcost)},clean:function(){s.Order.callbacks.clean.response.success=function(){location.reload()};var e={};e[s.actionName]="order/clean",s.send(e,s.Order.callbacks.clean,s.Callbacks.Order.clean)},submit:function(){if(s.Message.close(),s.ajaxProgress)return s.$doc.ajaxComplete((function(){s.ajaxProgress=!1,s.$doc.unbind("ajaxComplete"),s.Order.submit()})),!1;var e=s.Order.callbacks;return e.submit.before=function(){a(":button, a",s.Order.order).attr("disabled",!0).prop("disabled",!0)},e.submit.response.success=function(e){e.data.redirect?r.location.href=e.data.redirect:e.data.msorder?r.location.href=r.location.origin+r.location.pathname+(r.location.search?r.location.search+"&":"?")+"msorder="+e.data.msorder:location.reload()},e.submit.response.error=function(e){for(var r in setTimeout(function(){a(":button, a",s.Order.order).attr("disabled",!1).prop("disabled",!1)}.bind(this),3*s.timeout),a("[name]",s.Order.order).removeClass("error").closest(s.Order.inputParent).removeClass("error"),e.data)if(e.data.hasOwnProperty(r)){var t=e.data[r],n=a('[name="'+t+'"]',s.Order.order);"checkbox"==n.attr("type")||"radio"==n.attr("type")?n.closest(s.Order.inputParent).addClass("error"):n.addClass("error")}},s.send(s.sendData.formData,s.Order.callbacks.submit,s.Callbacks.Order.submit)},getrequired:function(e){var r=s.Order.callbacks;r.getrequired.response.success=function(e){a("[name]",s.Order.order).removeClass("required").closest(s.Order.inputParent).removeClass("required");for(var r=e.data.requires,t=0,n=r.length;t<n;t++)a("[name="+r[t]+"]",s.Order.order).addClass("required").closest(s.Order.inputParent).addClass("required")},r.getrequired.response.error=function(){a("[name]",s.Order.order).removeClass("required").closest(s.Order.inputParent).removeClass("required")};var t={id:e};t[s.actionName]="order/getrequired",s.send(t,s.Order.callbacks.getrequired,s.Callbacks.Order.getrequired)}},s.Message={initialize:function(){},close:function(){},show:function(e){""!=e&&alert(e)},success:function(e){},error:function(e){},info:function(e){}},s.Utils={empty:function(e){return void 0===e||0==e||null===e||!1===e||"string"==typeof e&&""==e.replace(/\s+/g,"")||"object"==typeof e&&0==e.length},formatPrice:function(e){var r=t.price_format;return e=this.number_format(e,r[0],r[1],r[2]),t.price_format_no_zeros&&r[0]>0&&(e=(e=e.replace(/(0+)$/,"")).replace(/[^0-9]$/,"")),e},formatWeight:function(e){var r=t.weight_format;return e=this.number_format(e,r[0],r[1],r[2]),t.weight_format_no_zeros&&r[0]>0&&(e=(e=e.replace(/(0+)$/,"")).replace(/[^0-9]$/,"")),e},number_format:function(e,r,a,t){var s,n;return isNaN(r=Math.abs(r))&&(r=2),null==a&&(a=","),null==t&&(t="."),(n=(s=parseInt(e=(+e||0).toFixed(r))+"").length)>3?n%=3:n=0,(n?s.substr(0,n)+t:"")+s.substr(n).replace(/(\d{3})(?=\d)/g,"$1"+t)+(r?a+Math.abs(e-s).toFixed(r).replace(/-/,"0").slice(2):"")},getValueFromSerializedArray:function(e,r){a.isArray(r)||(r=s.sendData.formData);for(var t=0,n=r.length;t<n;t++)if(r[t].name==e)return r[t].value;return null}},a(r).ready((function(e){s.initialize();var r=e("html");r.removeClass("no-js"),r.hasClass("js")||r.addClass("js")})),e.miniShop2=s}(window,document,jQuery,miniShop2Config);